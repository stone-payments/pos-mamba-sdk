<div
  ref:element
  tabindex={_tabPosition}
  on:click|stopPropagation|preventDefault="fire('_click', { data, index: key, sectionIndex, position })"
  shortcut={_shortcutComputed}
>
  <svelte:component
    ref:renderItemRef
    this="{renderItem}"
    key={key}
    {...data}
    position={position}
    {..._decorator}
    bind:isActive
  />
</div>

<script>

  export default {
    data() {
      return {
        key: undefined,
        renderItem: null,
        data: {},
      };
    },
    computed: {
      _shortcutComputed({ _shoulUseAutoShortcuts, _shortcut, data = {}}) {
        return _shoulUseAutoShortcuts ? _shortcut : data.shortcut || undefined;
      },
      _tabPosition({ position, hasFirstFocusable, _shortcutComputed}) {
        if(!hasFirstFocusable) return _shortcutComputed;
        return position + (hasFirstFocusable ? 0 : 1);
      },
      _decorator({ decorator }) {
        if(!decorator) return {};
        return decorator;
      },
      _shortcut({ key }) {
        if(key > 9) return undefined;
        if(key === 9) return 0;
        return key + 1;
      },
      _shoulUseAutoShortcuts({ useAutoShortcuts, hasFirstFocusable }) {
        return useAutoShortcuts && !hasFirstFocusable;
      },
    },
    oncreate() {
      this.fire('create');
    },
    onupdate({ changed, current }) {
      if(changed.isActive && current.isActive) {
        const { element } = this.refs;
        if(element) element.focus();
      }
    },
  };
</script>
