<svelte:document on:click="_handleDocumentClick(event)" />

{#if isFocused}
  <div class="keyboard">
    <div class="keys" class:with-math="isMathKeyboard">
      {#each keys as key}
        <button tabindex="-1" class="key" on:mousedown="handleOnClickInstanceKey(event, key)">
          {#if key.code === "delete"}
            <img class="icon" src="{deleteIcon}" alt="delete icon numeric keyboard" />
          {:elseif key.code === "confirmation"}
            <img class="icon" src="{confirmIcon}" alt="confirm icon numeric keyboard" />
          {:else}
            {key.code}
          {/if}
        </button>
      {/each}
    </div>

    {#if isMathKeyboard}
      <div class="keyboard-math">
        {#each mathKeys as key}
          <button tabindex="-1" class="key" on:mousedown="handleOnClickInstanceKey(event, key)">{key.code}</button>
        {/each}
      </div>
    {/if}
  </div>
{/if}

<script>import deleteIcon from './assets/num_delete.png';
  import confirmIcon from './assets/num_ok.png';

  // Libs
  import { VIRTUAL_KEYBOARD } from './libs/virtualKeyboard.js';

  // Controllers
  import VirtualKeyboardController from './Controllers/virtualKeyboard/VirtualKeyboardController.js';

  let controller;

  export default {
    helpers: {
      deleteIcon,
      confirmIcon,
    },
    data() {
      return {
        isFocused: false,
        inputRef: {},
        keys: VIRTUAL_KEYBOARD.KEYS,
        mathKeys: VIRTUAL_KEYBOARD.MATH,
      };
    },
    computed: {
      _inputProps: (
        props = {
          bgColor: undefined,
          label: undefined,
          placeholder: undefined,
          textColor: undefined,
          value: undefined,
          validation: undefined,
        },
      ) => ({
        ...props,
      }),
      isMathKeyboard: ({ type }) => {
        return type === 'math';
      },
    },
    oncreate() {
      controller = new VirtualKeyboardController(this);
      this.fire('setup', {
        setupInput: (...params) => {
          this.handleSetupInput(params);
        },
      });
    },
    methods: {
      handleOnClickInstanceKey(event, instance) {
        instance.onClick(event, controller);
      },
      openKeyboard() {
        controller.openKeyboard();
      },
      closeKeyboard() {
        controller.closeKeyboard();
      },
      _handleDocumentClick(event) {
        controller._handleClickOutside(event);
      },
    },
  };
</script>

<style type="text/postcss">
  .keyboard {
    width: 100%;
    min-width: 80%;
    max-height: 320px;
    border-top: 1px solid $gray700;
    background-color: $neutral50;
    position: fixed;
    bottom: 0;
    box-sizing: border-box;
    display: inline-block;
  }

  .key {
    width: calc(100% / 3);
    height: auto;
    border: 0;
    font-size: 20px;
    line-height: 40px;
    color: $neutral700;
    background-color: transparent;
  }

  .keys {
    width: 100%;

    &.with-math {
      max-width: 78%;
      display: inline-block;
      border-right: 2px solid rgba(0, 0, 0, 25%);

      .key {
        /* line-height: 70px; */
        line-height: 55px;
      }
    }
  }

  .keyboard-math {
    max-width: 20%;
    display: inline-block;

    .key {
      width: 100%;
      /* line-height: 51px;
      font-size: 30px; */
      line-height: 42px;
      font-size: 25px;
    }
  }

  .icon {
    max-width: 20px;
    max-height: 19px;
  }
</style>
