<script>
  import Dummy from './Dummy.html';

  export default {
    methods: {
      createDummy(opts) {
        return this.createComponent(Dummy, opts);
      },
      createComponent(Constructor, { methods, ...opts } = {}) {
        const instance = new Constructor({
          target: this.options.target,
          root: this,
          ...opts,
        });

        if (methods) {
          Object.keys(methods).forEach(key => {
            instance[key] = methods[key].bind(instance);
          });
        }

        this.on('destroy', () => instance.destroy());
        this._flush(this);

        return instance;
      },
      query(selector) {
        return this.options.target.querySelector(selector);
      },
      _flush(component) {
        component._lock = true;
        this._callAll(component._beforecreate);
        this._callAll(component._oncreate);
        this._callAll(component._aftercreate);
        component._lock = false;
      },
      _callAll(fns) {
        while (fns && fns.length) fns.shift()();
      },
    },
  };
</script>
